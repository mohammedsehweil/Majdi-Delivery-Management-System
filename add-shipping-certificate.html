<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Add Shipping Certificate</title>
  <link rel="stylesheet" href="./assets/styles.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>

  <style>
    @media print {
      body * { visibility: hidden; }
      #certificate-form, #certificate-form * { visibility: visible; }
      #certificate-form {
        position: absolute; inset: 0; width: 100%;
        margin: 0; padding: 20px; border: none; box-shadow: none;
      }
      .no-print { display: none !important; }
    }

    /* ===== Vertical Divider between Notes ===== */
    .notes-row {
      display: grid;
      grid-template-columns: 1fr 1px 1fr;
      gap: 0;
      align-items: start;
    }
    .notes-divider {
      background-color: #e5e7eb;
      width: 1px;
      height: 100%;
      min-height: 80px;
    }
    .notes-col {
      padding: 0 10px;
    }

    /* ===== Laboratory / Sample ===== */
    .lab-grid {
      display: grid;
      grid-template-columns: 1.1fr 1.2fr 1fr;
      gap: 12px;
      margin-top: 16px;
      border-top: 1px solid #e5e7eb;
      padding-top: 12px;
    }
    .lab-box {
      background: #fff;
      border: 1px solid #e5e7eb;
      border-radius: 6px;
      padding: 10px;
    }
    .lab-heading { font-weight: 700; font-size: 14px; margin-bottom: 8px; }
    .lab-line {
      border: 1px solid #e5e7eb; border-radius: 6px;
      height: 36px; display: flex; align-items: center;
      padding: 0 8px; color: #6b7280;
    }
    .lab-note {
      background:#f9fafb; border:1px solid #e5e7eb; border-radius:6px;
      padding:8px 10px; color:#374151;
    }
    .lab-checks { display: grid; grid-template-columns: 1fr; gap: 8px; }
    .lab-checks label { display: flex; align-items: center; gap: 8px; }
    .lab-stamp {
      border: 1px dashed #9ca3af; border-radius: 6px;
      min-height: 80px; display:flex; align-items:center; justify-content:center;
      color:#6b7280; background:#fff;
    }
    .lab-row { display: grid; gap: 8px; }
    .muted { color:#6b7280; font-size:12px; }
  </style>
</head>
<body>
  <div class="layout">
    <aside class="sidebar">
      <input class="search" type="text" placeholder="Search..." data-menu-search />
      <div class="menu-heading">Operations</div>
      <nav class="menu">
        <a href="add-shipping-certificate.html" class="active">Add Shipping Certificate</a>
        <a href="add-customer.html">Add Customer</a>
        <a href="add-project.html">Add Site</a>
        <a href="add-item.html">Add Item</a>
      </nav>
    </aside>

    <main class="main">
      <h1 class="page-title">Delivery Certificate Form</h1>

      <div class="card paper-form" id="certificate-form">
        <!-- Header -->
        <div class="form-grid" style="margin-bottom:12px; border-bottom:1px solid #e5e7eb; padding-bottom:10px;">
          <div class="form-group third"></div>
          <div class="form-group third" style="text-align:center">
            <div style="font-weight:800;">Builder Logistics Ltd.</div>
            <div class="helper">Jadida Al-Mafkar - Israel Tel: 972527529114</div>
          </div>
          <div class="form-group third" style="text-align:right">
            <img src="./assets/images/logo.png" alt="Logo" style="height:100px" />
          </div>
        </div>

        <!-- Date / Number -->
        <div class="form-grid" style="margin-bottom:16px; border-bottom:1px solid #e5e7eb; padding-bottom:12px;">
          <div class="form-group third">
            <label>Today's Date</label>
            <input id="scDate" name="scDate" type="date" />
          </div>
          <div class="form-group third" style="text-align:center">
            <div style="font-weight:800;font-size:18px;">
              Shipping Certificate No.: <span id="cert-number" style="color:#dc2626">--</span>
            </div>
          </div>
          <div class="form-group third"></div>
        </div>

        <form id="formAddShippingCert">
          <div class="form-grid">
            <!-- Customer / Project / Product -->
            <div class="form-group third">
              <label for="scCustomer">Customer</label>
              <select id="scCustomer" name="customerId">
                <option value="">-- Select Customer --</option>
              </select>
              
            </div>
            <div class="form-group third">
              <label for="scProject">Project / Site</label>
              <select id="scProject" name="deliveryLocationId">
                <option value="">-- Select Project --</option>
              </select>
            </div>
            <div class="form-group third">
              <label for="scItem">Product / Concrete Type</label>
              <select id="scItem" name="productId">
                <option value="">-- Select Product --</option>
              </select>
            </div>

            <!-- For Order / Delivery / Total -->
            <div class="form-group third">
              <label for="orderRef">For Order</label>
              <input id="orderRef" type="text" placeholder="Order reference / PO #" />
            </div>
            <div class="form-group third">
              <label for="currentDelivery">Current Delivery (Date)</label>
              <input id="currentDelivery" type="date" />
            </div>
            <div class="form-group third">
              <label for="totalAmount">Total</label>
              <input id="totalAmount" type="number" step="0.01" placeholder="0.00" />
            </div>

            <!-- Mixer / Driver / Plate -->
            <div class="form-group third">
              <label for="mixerNumber">Mixer No. / ID</label>
              <input id="mixerNumber" type="text" placeholder="e.g., MIXER-007" />
            </div>
            <div class="form-group third">
              <label for="driverName">Driver Name</label>
              <input id="driverName" type="text" placeholder="Full name" />
            </div>
            <div class="form-group third">
              <label for="licensePlate">License Plate</label>
              <input id="licensePlate" type="text" placeholder="e.g., JD 12345" />
            </div>
            
          </div>

          <!-- Notes + Divider -->
          <div class="notes-row" style="margin-top:16px;">
            <div class="notes-col">
              <label for="scNotes">Order Notes</label>
              <textarea id="scNotes" class="textarea--one-line" name="notes" placeholder="Any notes..."></textarea>
            </div>
            <div class="notes-divider"></div>
            <div class="notes-col">
              <label for="certificateNote">Certificate Note</label>
              <textarea id="certificateNote" class="textarea--one-line" name="certificateNote" placeholder="Optional note shown on certificate"></textarea>
            </div>
          </div>

          <!-- Technical -->
          <div class="form-grid" style="margin-top:16px; border-top:1px solid #e5e7eb; padding-top:12px;">
          <div class="form-group quarter">
              <label for="elementName">Element</label>
              <input id="elementName" name="elementName" type="text" placeholder="SC-0001" />
            </div>
            <div class="form-group quarter">
              <label for="exposureClass">Exposure level</label>
              <input id="exposureClass" type="text" placeholder="e.g., XC3/XD1" />
            </div>
            <div class="form-group quarter">
              <label for="chloridePerm">Chloride Permeability</label>
              <input id="chloridePerm" type="text" placeholder="Low / Very Low" />
            </div>
            <div class="form-group quarter">
              <label for="waterPerm">Water Permeability</label>
              <input id="waterPerm" type="text" placeholder="e.g., P8 / P10" />
            </div>
            
          </div>
          <!-- Time Records -->
          <div class="form-grid" style="margin-top:16px; border-top:1px solid #e5e7eb; padding-top:12px;">
            <div class="form-group quarter">
              <label for="timeDeparture">Departure Time</label>
              <input id="timeDeparture" type="time" />
            </div>
            <div class="form-group quarter">
              <label for="timeArrival">Site Arrival Time</label>
              <input id="timeArrival" type="time" />
            </div>
            <div class="form-group quarter">
              <label for="timeStartUnload">Unloading Start</label>
              <input id="timeStartUnload" type="time" />
            </div>
            <div class="form-group quarter">
              <label for="timeEndUnload">Unloading End</label>
              <input id="timeEndUnload" type="time" />
            </div>
          </div>

          <!-- Sampling  -->
          <div class="mini-sample">
            <div class="mini-sample__title">Sampling</div>

            <!-- Taking samples -->
            <div class="mini-sample__row">
              <span class="mini-sample__label">Taking samples:</span>
              <label class="mini-sample__inline">
                <input id="chkMixer" type="checkbox"> Mixer
              </label>
              <label class="mini-sample__inline">
                <input id="chkElement" type="checkbox"> Element
              </label>
            </div>

            <!-- Sample taken / not taken -->
            <div class="mini-sample__row">
              <label class="mini-sample__inline">
                <input id="chkTaken" type="checkbox"> Sample taken by approved laboratory
              </label>
              <label class="mini-sample__inline">
                <input id="chkNotTaken" type="checkbox"> Sample not taken
              </label>
            </div>

  <!-- Sampling time -->
  <div class="mini-sample__row">
    <label class="mini-sample__inline">
      <input id="chkTime" type="checkbox"> Sampling time
    </label>
  </div>

  <!-- Lab stamp -->
  <div class="mini-sample__note">Lab stamp &amp; sample signature</div>
</div>


          <!-- Signatures -->
          <div class="form-grid" style="margin-top:16px; border-top:1px solid #e5e7eb; padding-top:12px;">
            <div class="form-group half">
              <label>Signature & Authorization</label>
              <div class="form-grid">
                <div class="form-group half">
                  <div class="card" style="height:64px;display:flex;align-items:center;justify-content:center;">Contractor Signature</div>
                </div>
                <div class="form-group half">
                  <div class="card" style="height:64px;display:flex;align-items:center;justify-content:center;">Receiver Signature</div>
                </div>
              </div>
              <div class="helper"><b>Agreement:</b> Receiver confirms volume and mix type.</div>
            </div>

            <div class="form-group half no-print">
              <label>Actions</label>
              <div class="actions" style="justify-content:flex-end">
                <button class="btn btn-primary" type="submit">Save Certificate</button>
                <button class="btn btn-secondary" type="button" onclick="saveAsImage()">Save as Image</button>
                <button class="btn btn-secondary" type="button" onclick="window.print()">Print</button>
                <button class="btn" type="button" onclick="resetForm()">New</button>
              </div>
            </div>
          </div>
        </form>
      </div>

      <div id="message-box" class="helper" style="margin-top:12px;"></div>
    </main>
  </div>

  <script src="./config.js"></script>
  <script src="./assets/app.js"></script>

  <script>
    function resetForm() {
      document.getElementById('formAddShippingCert').reset();
      document.getElementById('scDate').valueAsDate = new Date();
      document.getElementById('cert-number').textContent = "--";
    }

    function saveAsImage() {
      const el = document.getElementById('certificate-form');
      const fileName = `certificate-${document.getElementById('cert-number').textContent || 'download'}.png`;
      html2canvas(el, { scale: 2 }).then(canvas => {
        const a = document.createElement('a');
        a.href = canvas.toDataURL('image/png');
        a.download = fileName;
        document.body.appendChild(a); a.click(); a.remove();
      });
    }

    (function initCertMeta(){
      document.getElementById('scDate').valueAsDate = new Date();
    })();
  </script>
</body>
</html>
